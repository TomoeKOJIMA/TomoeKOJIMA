<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>つくるについて考える</title>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            background-color: #333;
            width: 100%;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding-top: 5vh;
            box-sizing: border-box;
        }
        #image-mask {
            width: 100%;
            max-width: 850px;
            height: 0;
            overflow: hidden;
        }
        #image-mask img {
            display: block;
            width: 100%;
        }
    </style>
</head>
<body>

    <div id="image-mask">
        <img id="reveal-image" src="gallery1_plan.png" alt="Loading Document...">
    </div>

    <script>
        const mask = document.getElementById('image-mask');
        const image = document.getElementById('reveal-image');
        let fullHeight = 0;
        let currentStepIndex = 0;

        // ▼▼▼ ここからが、すべてをランダムにするための心臓部です ▼▼▼

        // ランダムなブロック分割を生成する関数
        function generateRandomBlocks() {
            const steps = [];
            let cumulativePercent = 0;
            
            // 5～15の間で、ブロックの数をランダムに決める
            const blockCount = Math.floor(Math.random() * 11) + 5;

            for (let i = 0; i < blockCount; i++) {
                // 各ブロックの大きさをランダムに決める
                let chunkSize = Math.random();
                
                // 最後のブロックは必ず100%になるように調整
                if (i === blockCount - 1) {
                    cumulativePercent = 1.0;
                } else {
                    // 95%を超えない範囲で大きさを決める
                    cumulativePercent += chunkSize / blockCount;
                    if (cumulativePercent > 0.95) {
                        cumulativePercent = 0.95;
                    }
                }
                
                // 各ブロックの表示速度（1が遅く、5が速い）と、表示後の待ち時間をランダムに設定
                steps.push({
                    toPercent: cumulativePercent,
                    speed: Math.random() * 4 + 1,
                    pauseAfter: Math.floor(Math.random() * 2001) + 800 // 0.8秒～2.8秒
                });

                if (cumulativePercent >= 1.0) break;
            }
            return steps;
        }

        // ▼▼▼ ここまでが心臓部です ▼▼▼


        const steps = generateRandomBlocks();
        const intervalTime = 16; // アニメーションの滑らかさ

        // 指定した高さまで、指定した速度でマスクを広げる関数
        function animateTo(targetHeight, speed) {
            const revealInterval = setInterval(() => {
                let currentHeight = parseFloat(mask.style.height) || 0;
                
                if (currentHeight >= targetHeight) {
                    clearInterval(revealInterval);
                    mask.style.height = targetHeight + 'px'; // ぴったり合わせる
                    
                    // 次のステップへ進む準備
                    setTimeout(() => {
                        currentStepIndex++;
                        runNextStep();
                    }, steps[currentStepIndex -1].pauseAfter); // 実行済みのステップの待ち時間を参照
                } else {
                    mask.style.height = (currentHeight + speed) + 'px';
                }
            }, intervalTime);
        }

        // 次のステップを実行する関数
        function runNextStep() {
            if (currentStepIndex >= steps.length) return; // 全て完了

            const step = steps[currentStepIndex];
            const targetHeight = fullHeight * step.toPercent;
            animateTo(targetHeight, step.speed);
        }

        // 画像の高さが取得できるのを待ってから、すべてを開始する
        const startupInterval = setInterval(() => {
            if (image.scrollHeight > 0) {
                clearInterval(startupInterval);
                fullHeight = image.scrollHeight;
                // 最初の表示をゆっくり開始
                setTimeout(runNextStep, 1500);
            }
        }, 100);
    </script>

</body>
</html>
